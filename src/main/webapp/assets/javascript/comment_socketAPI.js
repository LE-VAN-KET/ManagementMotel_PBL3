function CommentSocketAPI(postId,userId){let websocket=null;if("WebSocket"in window){function processOpen(message){}function processMessage(message){let data=JSON.parse(message.data);if(void 0===data.urlRedirect)switch(data.method){case"add":addComment(data);break;case"delete":delComment(data);break;case"update":updateComment(data)}else location.replace(data.urlRedirect)}function processClose(message){console.log("Server Disconnect...")}function processError(message){console.log("error"+message)}websocket=new WebSocket("wss://" + window.location.host + "/comment/"+postId),websocket.onopen=message=>{},websocket.onmessage=message=>processMessage(message),websocket.onclose=message=>processClose(message),websocket.onerror=message=>processError(message),window.onbeforeunload=function(){websocket.close()},$("#formComment").submit((function(e){void 0!==websocket&&websocket.readyState==WebSocket.OPEN&&(websocket.send(JSON.stringify({content:$.trim($("#formComment textarea[name='content']").val()),method:"add"})),$('textarea[name="content"]').val(""),$('textarea[name="content"]').height("auto")),e.preventDefault()})),$("#formEdit").submit((function(e){let content=$.trim($("#formEdit textarea[name='content']").val());""===content?elementRemoveComment.click():void 0!==websocket&&websocket.readyState==WebSocket.OPEN&&websocket.send(JSON.stringify({commentId:$("#formEdit").attr("data-commentid"),content:content,method:"update"})),$("#formEdit").css({display:"none"}),e.preventDefault()})),$("#btnRemove").click((function(){void 0!==websocket&&websocket.readyState==WebSocket.OPEN&&(websocket.send(JSON.stringify({commentId:$(this).attr("data-commentid"),method:"delete"})),$("#confirm-delete").modal("toggle"))}));const addComment=data=>{data.errors?data.errors.forEach(err=>{toastr.error(err,"Comment failed")}):Comments.add(data)},delComment=data=>{data.errors?toastr.error(data.errors,"Delete comment failed"):Comments.delete(data)},updateComment=data=>{data.errors?toastr.error(data.errors,"Update comment failed"):Comments.update(data)};$("#formComment textarea[name='content']").on("keyup",(function(event){13===event.keyCode&&(event.preventDefault(),$("#formComment").submit())})),$("#formEdit textarea[name='content']").on("keyup",(function(event){13===event.keyCode&&(event.preventDefault(),$("#formEdit").submit())}))}else toastr.info("The browser does not support websocket");const Comments={add:function(data){let commentAction="",commentAuthor="";userId==data.comment.userModel.userId&&(commentAction+='<div class="comments-list-action action-toggle bg-transparent"><div class="dropdown"><a href="#" data-toggle="dropdown"><i class="fas fa-ellipsis-h"></i></a><div class="dropdown-menu dropdown-menu-right"><a class="dropdown-item text-dark" href="javascript:void(0)" onclick="editComment(this)"><i class="far fa-edit mr-2"></i>Edit</a><a class="dropdown-item text-dark" href="javascript:void(0)" data-toggle="modal" data-target="#confirm-delete"><i class="fas fa-trash mr-2"></i>Remove</a></div></div></div>',commentAuthor+="by-author"),$("#comments-list").append('<li><div class="comment-main-level row m-0" data-userid='+data.comment.userModel.userId+" data-commentid="+data.comment.commentId+'><div class="comment-avatar col-1 p-0"><img class="img-fluid img-thumbnail lazyload p-0 "data-src="/assets/images/143086968_2856368904622192_1959732218791162458_n.png" alt="image..."></div><div class="comment-box col-10"><div class="comment-head"><h6 class="comment-name '+commentAuthor+'"><a href="#">'+data.comment.userModel.fullName+'</a></h6><span class="posted-time">Posted on '+data.createAt+"</span>"+commentAction+'</div><div class="comment-content"><p class="p-0 m-0">'+data.comment.content+"</p></div></div></div></li>")},update:function(data){$(".comment-main-level").each((function(){$(this).data("commentid")==data.comment.commentId&&($(this).find(".post-time").text("Updated on "+data.modifiedAt),$(this).find(".comment-content p").text(data.comment.content),userId==data.comment.userModel.userId&&toastr.success("update comment successfully"))}))},delete:function(data){$(".comment-main-level").each((function(){$(this).data("commentid")==data.comment.commentId&&($(this).remove(),userId==data.comment.userModel.userId&&toastr.success("delete comment successfully"))})),$("#formEdit").css({display:"none"})}}}