'use strict';function CommentSocketAPI(g,e){let c=null;if("WebSocket"in window){var h=function(a){console.log("error"+a)},k=function(a){console.log("Server Disconnect...")},l=function(a){a=JSON.parse(a.data);if(void 0===a.urlRedirect)switch(a.method){case "add":b(a);break;case "delete":a.errors?toastr.error(a.errors,"Delete comment failed"):f.delete(a);break;case "update":a.errors?toastr.error(a.errors,"Update comment failed"):f.update(a)}else location.replace(a.urlRedirect)};c=new WebSocket("wss://" + window.location.host + "/comment/"+
g);c.onopen=a=>{};c.onmessage=a=>l(a);c.onclose=a=>k(a);c.onerror=a=>h(a);window.onbeforeunload=function(){c.close()};$("#formComment").submit(function(a){void 0!==c&&c.readyState==WebSocket.OPEN&&(c.send(JSON.stringify({content:$.trim($("#formComment textarea[name='content']").val()),method:"add"})),$('textarea[name="content"]').val(""),$('textarea[name="content"]').height("auto"));a.preventDefault()});$("#formEdit").submit(function(a){let d=$.trim($("#formEdit textarea[name='content']").val());
""===d?elementRemoveComment.click():void 0!==c&&c.readyState==WebSocket.OPEN&&c.send(JSON.stringify({commentId:$("#formEdit").attr("data-commentid"),content:d,method:"update"}));$("#formEdit").css({display:"none"});a.preventDefault()});$("#btnRemove").click(function(){void 0!==c&&c.readyState==WebSocket.OPEN&&(c.send(JSON.stringify({commentId:$(this).attr("data-commentid"),method:"delete"})),$("#confirm-delete").modal("toggle"))});const b=a=>{a.errors?a.errors.forEach(d=>{toastr.error(d,"Comment failed")}):
f.add(a)};$("#formComment textarea[name='content']").on("keyup",function(a){13===a.keyCode&&(a.preventDefault(),$("#formComment").submit())});$("#formEdit textarea[name='content']").on("keyup",function(a){13===a.keyCode&&(a.preventDefault(),$("#formEdit").submit())})}else toastr.info("The browser does not support websocket");const f={add:function(b){let a="",d="";e==b.comment.userModel.userId&&(a+='<div class="comments-list-action action-toggle bg-transparent"><div class="dropdown"><a href="#" data-toggle="dropdown"><i class="fas fa-ellipsis-h"></i></a><div class="dropdown-menu dropdown-menu-right"><a class="dropdown-item text-dark" href="javascript:void(0)" onclick="editComment(this)"><i class="far fa-edit mr-2"></i>Edit</a><a class="dropdown-item text-dark" href="javascript:void(0)" data-toggle="modal" data-target="#confirm-delete"><i class="fas fa-trash mr-2"></i>Remove</a></div></div></div>',
d+="by-author");$("#comments-list").append('<li><div class="comment-main-level row m-0" data-userid='+b.comment.userModel.userId+" data-commentid="+b.comment.commentId+'><div class="comment-avatar col-1 p-0"><img class="img-fluid img-thumbnail lazyload p-0 "data-src="/assets/images/143086968_2856368904622192_1959732218791162458_n.png" alt="image..."></div><div class="comment-box col-10"><div class="comment-head"><h6 class="comment-name '+d+'"><a href="#">'+b.comment.userModel.fullName+'</a></h6><span class="posted-time">Posted on '+
b.createAt+"</span>"+a+'</div><div class="comment-content"><p class="p-0 m-0">'+b.comment.content+"</p></div></div></div></li>")},update:function(b){$(".comment-main-level").each(function(){$(this).data("commentid")==b.comment.commentId&&($(this).find(".post-time").text("Updated on "+b.modifiedAt),$(this).find(".comment-content p").text(b.comment.content),e==b.comment.userModel.userId&&toastr.success("update comment successfully"))})},delete:function(b){$(".comment-main-level").each(function(){$(this).data("commentid")==
b.comment.commentId&&($(this).remove(),e==b.comment.userModel.userId&&toastr.success("delete comment successfully"))});$("#formEdit").css({display:"none"})}}};